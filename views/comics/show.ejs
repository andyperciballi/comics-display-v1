<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="/images/icon.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= comic.title %> - Comic Details</title>
  </head>
  <body>
    <%- include('../partials/_navbar.ejs') %>

    <main class="comic-detail-container">
      <h1 class="comic-detail-title"><%= comic.title %></h1>

      <div class="comic-detail-content">
        <!-- Cover Image -->
        <% if (comic.imageUrl) { %>
          <div class="comic-cover">
            <img src="<%= comic.imageUrl %>" alt="<%= comic.title %> cover" class="comic-cover-image" />
          </div>
        <% } %>

        <!-- Comic Details -->
        <div class="comic-details">
          <div class="detail-group">
            <span class="detail-label">Author:</span>
            <span class="detail-value"><%= comic.author || 'Unknown' %></span>
          </div>

          <div class="detail-group">
            <span class="detail-label">Issue Number:</span>
            <span class="detail-value"><%= comic.issueNumber || 'N/A' %></span>
          </div>

          <div class="detail-group">
            <span class="detail-label">Condition:</span>
            <span class="detail-value condition-badge condition-<%= comic.condition.toLowerCase().replace(' ', '-') %>">
              <%= comic.condition %>
            </span>
          </div>

          <% if (comic.estimatedValue) { %>
            <div class="detail-group">
              <span class="detail-label">Estimated Value:</span>
              <span class="detail-value">$<%= comic.estimatedValue.toFixed(2) %></span>
            </div>
          <% } %>

          <% if (comic.notes) { %>
            <div class="detail-group notes-group">
              <span class="detail-label">Notes:</span>
              <p class="detail-notes"><%= comic.notes %></p>
            </div>
          <% } %>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="comic-actions-detail">
        <% if (comic.user.toString() === user._id.toString()) { %>
          <!-- Owner sees Edit and Delete -->
          <form action="/users/<%= user._id %>/comics/<%= comic._id %>/edit" method="GET" class="action-form-inline">
            <button type="submit" class="edit-button-large">Edit Comic</button>
          </form>

          <form action="/users/<%= user._id %>/comics/<%= comic._id %>?_method=DELETE" method="POST" class="action-form-inline">
            <button type="submit" class="delete-button-large" onclick="return confirm('Are you sure you want to delete this comic?')">Delete Comic</button>
          </form>

          <a href="/users/<%= user._id %>/comics" class="back-link">Back to My Shelf</a>
        <% } else { %>
          <!-- Non-owner sees Favorite button -->
          <button class="favorite-button-large">Add to Favorites</button>
          <a href="/users/<%= comic.user %>/comics" class="back-link">Back to Their Shelf</a>
        <% } %>
      </div>
    </main>
  </body>
</html>